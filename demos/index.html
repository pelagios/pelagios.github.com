<html>
  <head>
    <title>PELAGIOS Test</title>
    <link rel="stylesheet" href="http://pelagios.github.io/pelagios-heatmap/leaflet/leaflet.css" />
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script type="text/javascript" src="http://pelagios.github.io/pelagios-heatmap/leaflet/leaflet.js"></script>
    <script type="text/javascript" charset="utf-8">
      $(function() {
        var baseLayer = L.tileLayer('http://pelagios.dme.ait.ac.at/tilesets/imperium//{z}/{x}/{y}.png', {
          attribution: 'Tiles: <a href="http://pelagios.dme.ait.ac.at/maps/greco-roman/about.html">Pelagios</a>, 2012; Data: NASA, OSM, Pleiades, DARMC',
        });
 
        var map = new L.Map('map', {
          center: new L.LatLng(41.893588, 12.488022),
          zoom: 5,
          layers: [baseLayer],
          minZoom: 5,
          maxZoom: 11
        });
        
        var renderJSON = function(data, color, layer) {
          $.each(data, function(index, annotation) {
            if (annotation.place.geometry) {
              L.geoJson(annotation.place.geometry, {
                
                onEachFeature: function(feature, l) {
                  var uri = annotation.place.source.substring(0, annotation.place.source.indexOf("#this"));
                  l.bindPopup(annotation.transcription + ' (<a target="_blank" href="http://pelagios.dme.ait.ac.at/api/places/' + encodeURIComponent(uri) + '">' + annotation.place.title + '</a>)');
                },
                
                pointToLayer: function (feature, latlng) { 
                          return L.circleMarker(latlng, { radius: 5 }); 
                },
                
                style: {
                  color: color, 
                  opacity: 0.8, 
                  fillOpacity: 0.65
                } 
              }).addTo(layer);
            }
          });
        };
        
        var layer01 = L.layerGroup().addTo(map);
        $.getJSON('Vicarello-Beaker-1.json', function(data) { renderJSON(data, '#0000ff', layer01); });
        
        var layer02 = L.layerGroup();
        $.getJSON('Vicarello-Beaker-2.json', function(data) { renderJSON(data, '#ff0000', layer02); });
        
        var layer03 = L.layerGroup();
        $.getJSON('Vicarello-Beaker-3.json', function(data) { renderJSON(data, '#009900', layer03); });
        
        var layer04 = L.layerGroup();
        $.getJSON('Vicarello-Beaker-4.json', function(data) { renderJSON(data, 'orange', layer04); });        
        
        L.control.layers({}, {
          "Vicarello Beaker I": layer01,
          "Vicarello Beaker II": layer02,
          "Vicarello Beaker III": layer03,
          "Vicarello Beaker IV": layer04
        }).addTo(map);
      });
    </script>
  </head>
  <body>
  <div id="map" style="width:100%px; height:100%;"></div>
  </body>
</html>
