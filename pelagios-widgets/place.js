/**
 * Pelagios utility functions
 * @license GPL v3(see LICENSE.txt)
 */

/** @license
* RequireJS plugin for async dependency load like JSONP and Google Maps
* Author: Miller Medeiros
* Version: 0.1.1 (2011/11/17)
* Released under the MIT license
*/

/**
 * Pelagios search map library
 * @license GPL v3(see LICENSE.txt)
 */

/**
 * Pelagios place map library
 * @license GPL v3(see LICENSE.txt)
 */

/**
 * @license RequireJS text 2.0.0 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * Pelagios common library
 * @license GPL v3(see LICENSE.txt)
 */

/**
 * Pelagios place widget
 * @license GPL v3(see LICENSE.txt)
 */

define("app/util",[],function(){function createID(dataset){var id=dataset.replace(/ /g,"");return id=id.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,""),id}function includesGoogleMaps2(){return typeof GMap2!="undefined"}function getAPIData(url,success,error,timeout,cors){var settings={type:"POST",dataType:"json",timeout:timeout,success:success,error:error};error||(settings.error=function(jqXHR,textStatus,errorThrown){console.log("ERROR: Call to "+url+" failed: "+textStatus),console.log(jqXHR)});if(!cors)$.ajax(url,settings);else{try{var xhr=new XMLHttpRequest}catch(error){var xhr={}}if("withCredentials"in xhr)$.ajax(url,settings);else if(typeof XDomainRequest!="undefined"){var xdr=new XDomainRequest;xdr.timeout=timeout,xdr.open("get",url),xdr.onload=function(){success($.parseJSON(xdr.responseText),"",xdr)},xdr.onerror=error,xdr.send()}}}return{createID:createID,includesGoogleMaps2:includesGoogleMaps2,getAPIData:getAPIData}}),define("lib/async",[],function(){function injectScript(src){var s,t;s=document.createElement("script"),s.type="text/javascript",s.async=!0,s.src=src,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(s,t)}function formatUrl(name,id){var paramRegex=/!(.+)/,url=name.replace(paramRegex,""),param=paramRegex.test(name)?name.replace(/.+!/,""):DEFAULT_PARAM_NAME;return url+=url.indexOf("?")<0?"?":"&",url+param+"="+id}function uid(){return _uid+=1,"__async_req_"+_uid+"__"}var DEFAULT_PARAM_NAME="callback",_uid=0;return{load:function(name,req,onLoad,config){if(config.isBuild)onLoad(null);else{var id=uid();window[id]=onLoad,injectScript(formatUrl(name,id))}}}}),define("app/search_map",["lib/async!http://maps.google.com/maps/api/js?sensor=false"],function(){function SearchMap(id){if(!document.getElementById(id))throw Error("ERROR: Invalid ID for search map");var map=new google.maps.Map(document.getElementById(id),{mapTypeId:google.maps.MapTypeId.TERRAIN}),markerBounds=new google.maps.LatLngBounds,infoWindow=new google.maps.InfoWindow;this.refresh=function(){google.maps.event.trigger(map,"resize"),map.fitBounds(markerBounds)},this.addMarker=function(geojson,title,content,onClickHander){if(geojson.hasOwnProperty("geometry")&&geojson.geometry!=null&&geojson.geometry.hasOwnProperty("type")&&geojson.geometry.type=="Point"){var location=new google.maps.LatLng(geojson.geometry.coordinates[1],geojson.geometry.coordinates[0]),marker=new google.maps.Marker({position:location,map:map,title:title});markerBounds.extend(location),google.maps.event.addListener(marker,"click",function(){return function(){infoWindow.close(),infoWindow.setContent(content),infoWindow.open(map,marker),onClickHander()}}())}}}return{SearchMap:SearchMap}}),define("app/place_map",["lib/async!http://maps.google.com/maps/api/js?sensor=false"],function(){function PlaceMap(id){if(!document.getElementById(id))throw Error("ERROR: Invalid ID for place map");var map=new google.maps.Map(document.getElementById(id),{zoom:8,mapTypeId:google.maps.MapTypeId.TERRAIN}),marker=new google.maps.Marker({map:map});this.refresh=function(){google.maps.event.trigger(map,"resize"),map.setCenter(marker.getPosition())},this.setMarker=function(coordinates,title){var location=new google.maps.LatLng(coordinates[1],coordinates[0]);marker.setPosition(location),marker.setTitle(title),map.setCenter(location),google.maps.event.trigger(map,"resize")}}return{PlaceMap:PlaceMap}}),define("lib/text",["module"],function(module){var progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],xmlRegExp=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,bodyRegExp=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,hasLocation=typeof location!="undefined"&&location.href,defaultProtocol=hasLocation&&location.protocol&&location.protocol.replace(/\:/,""),defaultHostName=hasLocation&&location.hostname,defaultPort=hasLocation&&(location.port||undefined),buildMap=[],masterConfig=module.config(),text,fs;return text={version:"2.0.0",strip:function(content){if(content){content=content.replace(xmlRegExp,"");var matches=content.match(bodyRegExp);matches&&(content=matches[1])}else content="";return content},jsEscape:function(content){return content.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var xhr,i,progId;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(i=0;i<3;i++){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}return xhr},parseName:function(name){var strip=!1,index=name.indexOf("."),modName=name.substring(0,index),ext=name.substring(index+1,name.length);return index=ext.indexOf("!"),index!==-1&&(strip=ext.substring(index+1,ext.length),strip=strip==="strip",ext=ext.substring(0,index)),{moduleName:modName,ext:ext,strip:strip}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(url,protocol,hostname,port){var match=text.xdRegExp.exec(url),uProtocol,uHostName,uPort;return match?(uProtocol=match[2],uHostName=match[3],uHostName=uHostName.split(":"),uPort=uHostName[1],uHostName=uHostName[0],(!uProtocol||uProtocol===protocol)&&(!uHostName||uHostName===hostname)&&(!uPort&&!uHostName||uPort===port)):!0},finishLoad:function(name,strip,content,onLoad){content=strip?text.strip(content):content,masterConfig.isBuild&&(buildMap[name]=content),onLoad(content)},load:function(name,req,onLoad,config){if(config.isBuild&&!config.inlineText){onLoad();return}masterConfig.isBuild=config.isBuild;var parsed=text.parseName(name),nonStripName=parsed.moduleName+"."+parsed.ext,url=req.toUrl(nonStripName),useXhr=masterConfig.useXhr||text.useXhr;!hasLocation||useXhr(url,defaultProtocol,defaultHostName,defaultPort)?text.get(url,function(content){text.finishLoad(name,parsed.strip,content,onLoad)},function(err){onLoad.error&&onLoad.error(err)}):req([nonStripName],function(content){text.finishLoad(parsed.moduleName+"."+parsed.ext,parsed.strip,content,onLoad)})},write:function(pluginName,moduleName,write,config){if(buildMap.hasOwnProperty(moduleName)){var content=text.jsEscape(buildMap[moduleName]);write.asModule(pluginName+"!"+moduleName,"define(function () { return '"+content+"';});\n")}},writeFile:function(pluginName,moduleName,req,write,config){var parsed=text.parseName(moduleName),nonStripName=parsed.moduleName+"."+parsed.ext,fileName=req.toUrl(parsed.moduleName+"."+parsed.ext)+".js";text.load(nonStripName,req,function(value){var textWrite=function(contents){return write(fileName,contents)};textWrite.asModule=function(moduleName,contents){return write.asModule(moduleName,fileName,contents)},text.write(pluginName,nonStripName,textWrite,config)},config)}},typeof process!="undefined"&&process.versions&&!!process.versions.node?(fs=require.nodeRequire("fs"),text.get=function(url,callback){var file=fs.readFileSync(url,"utf8");file.indexOf("ï»¿")===0&&(file=file.substring(1)),callback(file)}):text.createXhr()?text.get=function(url,callback,errback){var xhr=text.createXhr();xhr.open("GET",url,!0),masterConfig.onXhr&&masterConfig.onXhr(xhr,url),xhr.onreadystatechange=function(evt){var status,err;xhr.readyState===4&&(status=xhr.status,status>399&&status<600?(err=new Error(url+" HTTP status: "+status),err.xhr=xhr,errback(err)):callback(xhr.responseText))},xhr.send(null)}:typeof Packages!="undefined"&&(text.get=function(url,callback){var encoding="utf-8",file=new java.io.File(url),lineSeparator=java.lang.System.getProperty("line.separator"),input=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file),encoding)),stringBuffer,line,content="";try{stringBuffer=new java.lang.StringBuffer,line=input.readLine(),line&&line.length()&&line.charAt(0)===65279&&(line=line.substring(1)),stringBuffer.append(line);while((line=input.readLine())!==null)stringBuffer.append(lineSeparator),stringBuffer.append(line);content=String(stringBuffer.toString())}finally{input.close()}callback(content)}),text}),define("lib/text!template/widget_container.tmpl",[],function(){return'(function() {\n  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};\ntemplates[\'widget_container\'] = template(function (Handlebars,depth0,helpers,partials,data) {\n  helpers = helpers || Handlebars.helpers;\n  var buffer = "", stack1, stack2, foundHelper, tmp1, self=this, functionType="function", helperMissing=helpers.helperMissing, undef=void 0, escapeExpression=this.escapeExpression;\n\nfunction program1(depth0,data) {\n  \n  var buffer = "", stack1;\n  buffer += "\\r\\n        <a href=\\"\\" class=\\"close\\">\\r\\n        <img src=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.baseURL);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.baseURL", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "images/icons/close-button.png\\" alt=\\"Close Pelagios information\\" />\\r\\n        </a>    \\r\\n        ";\n  return buffer;}\n\nfunction program3(depth0,data) {\n  \n  var buffer = "", stack1;\n  buffer += "\\r\\n<img id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-icon\\" class=\\"icon\\" src=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.baseURL);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.baseURL", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "images/icons/pelagios.png\\" alt=\\"Information about this place from Pelagios partners\\"/> \\r\\n";\n  return buffer;}\n\n  buffer += "<div id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-container\\" class=\\"container\\">    \\r\\n    <div class=\\"header\\"> \\r\\n        <img class=\\"logo\\" src=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.imageDir);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.imageDir", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "icons/pelagios-logo.png\\" alt=\\"View Pelagios infromation\\"/>    \\r\\n        ";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.icon);\n  stack2 = helpers[\'if\'];\n  tmp1 = self.program(1, program1, data);\n  tmp1.hash = {};\n  tmp1.fn = tmp1;\n  tmp1.inverse = self.noop;\n  stack1 = stack2.call(depth0, stack1, tmp1);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += "\\r\\n    </div>    \\r\\n    <div class=\\"content-wrapper\\">\\r\\n        <div id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-content\\">\\r\\n        </div>\\r\\n        <div class=\\"footer\\"></div>                           \\r\\n    </div>\\r\\n</div>    \\r\\n";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.icon);\n  stack2 = helpers[\'if\'];\n  tmp1 = self.program(3, program3, data);\n  tmp1.hash = {};\n  tmp1.fn = tmp1;\n  tmp1.inverse = self.noop;\n  stack1 = stack2.call(depth0, stack1, tmp1);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += "  ";\n  return buffer;});\n})();'}),define("lib/text!template/place.tmpl",[],function(){return'(function() {\n  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};\ntemplates[\'place\'] = template(function (Handlebars,depth0,helpers,partials,data) {\n  helpers = helpers || Handlebars.helpers;\n  var buffer = "", stack1, foundHelper, self=this, functionType="function", helperMissing=helpers.helperMissing, undef=void 0, escapeExpression=this.escapeExpression;\n\n\n  buffer += "<div id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-pleiades\\">    \\r\\n</div>    \\r\\n<div id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-sections\\"></div>   \\r\\n\\r\\n";\n  return buffer;});\n})();'}),define("lib/text!template/section.tmpl",[],function(){return'(function() {\n  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};\ntemplates[\'section\'] = template(function (Handlebars,depth0,helpers,partials,data) {\n  helpers = helpers || Handlebars.helpers;\n  var buffer = "", stack1, foundHelper, self=this, functionType="function", helperMissing=helpers.helperMissing, undef=void 0, escapeExpression=this.escapeExpression;\n\n\n  buffer += "<div class=\\"section\\" id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-";\n  foundHelper = helpers.name;\n  stack1 = foundHelper || depth0.name;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "name", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\">\\r\\n<div class=\\"section-header\\" id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-header-";\n  foundHelper = helpers.name;\n  stack1 = foundHelper || depth0.name;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "name", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\">\\r\\n<img src=\\"";\n  foundHelper = helpers.iconURL;\n  stack1 = foundHelper || depth0.iconURL;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "iconURL", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" class=\\"section-icon\\" alt=\\"\\" />\\r\\n<h2>";\n  foundHelper = helpers.title;\n  stack1 = foundHelper || depth0.title;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "title", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "</h2>\\r\\n<img class=\\"section-toggle\\" id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-toggle-";\n  foundHelper = helpers.name;\n  stack1 = foundHelper || depth0.name;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "name", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" \\r\\n     src=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.baseURL);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.baseURL", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "images/icons/right-arrow.png\\" alt=\\"Toggle section\\"/>\\r\\n<p class=\\"section-strapline\\">";\n  foundHelper = helpers.strapline;\n  stack1 = foundHelper || depth0.strapline;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "strapline", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "</p>\\r\\n</div>\\r\\n<div class=\\"section-content\\" id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-content-";\n  foundHelper = helpers.name;\n  stack1 = foundHelper || depth0.name;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "name", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\">\\r\\n</div></div>\\r\\n";\n  return buffer;});\n})();'}),define("lib/text!template/flickr.tmpl",[],function(){return'(function() {\n  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};\ntemplates[\'flickr\'] = template(function (Handlebars,depth0,helpers,partials,data) {\n  helpers = helpers || Handlebars.helpers;\n  var buffer = "", stack1, stack2, foundHelper, tmp1, self=this, functionType="function", helperMissing=helpers.helperMissing, undef=void 0, escapeExpression=this.escapeExpression;\n\nfunction program1(depth0,data) {\n  \n  var buffer = "", stack1;\n  buffer += "\\r\\n<a href=\\"http://www.flickr.com/photos/";\n  stack1 = depth0.owner;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.owner", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "/";\n  stack1 = depth0.id;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.id", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" target=\\"_blank\\">\\r\\n<img src=\\"http://farm";\n  stack1 = depth0.farm;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.farm", { hash: {} }); }\n  buffer += escapeExpression(stack1) + ".staticflickr.com/";\n  stack1 = depth0.server;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.server", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "/";\n  stack1 = depth0.id;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.id", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "_";\n  stack1 = depth0.secret;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.secret", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "_t.jpg\\" alt=\\"";\n  foundHelper = helpers.pthis;\n  stack1 = foundHelper || depth0.pthis;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.title);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "pthis.title", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" />\\r\\n</a>\\r\\n";\n  return buffer;}\n\nfunction program3(depth0,data) {\n  \n  var buffer = "", stack1;\n  buffer += "\\r\\n<p><a href=\\"http://www.flickr.com/groups/pleiades-places/pool/tags/pleiades%3Adepicts%3D";\n  foundHelper = helpers.pleiadesID;\n  stack1 = foundHelper || depth0.pleiadesID;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "pleiadesID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "/\\" target=\\"_blank\\">View all ";\n  foundHelper = helpers.photo;\n  stack1 = foundHelper || depth0.photo;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.length);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "photo.length", { hash: {} }); }\n  buffer += escapeExpression(stack1) + " photos on flickr</a></p>\\r\\n";\n  return buffer;}\n\nfunction program5(depth0,data) {\n  \n  var buffer = "", stack1;\n  buffer += "\\r\\n<p><a href=\\"http://www.flickr.com/photos/tags/pleiades%3Adepicts%3D";\n  foundHelper = helpers.pleiadesID;\n  stack1 = foundHelper || depth0.pleiadesID;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "pleiadesID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "/\\" target=\\"_blank\\">View all ";\n  foundHelper = helpers.photo;\n  stack1 = foundHelper || depth0.photo;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.length);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "photo.length", { hash: {} }); }\n  buffer += escapeExpression(stack1) + " photos on flickr</a></p>\\r\\n";\n  return buffer;}\n\n  foundHelper = helpers.photo;\n  stack1 = foundHelper || depth0.photo;\n  stack2 = helpers.each;\n  tmp1 = self.program(1, program1, data);\n  tmp1.hash = {};\n  tmp1.fn = tmp1;\n  tmp1.inverse = self.noop;\n  stack1 = stack2.call(depth0, stack1, tmp1);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += "\\r\\n";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.pleiadesFlickrGroupOnly);\n  stack2 = helpers[\'if\'];\n  tmp1 = self.program(3, program3, data);\n  tmp1.hash = {};\n  tmp1.fn = tmp1;\n  tmp1.inverse = self.noop;\n  stack1 = stack2.call(depth0, stack1, tmp1);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += "\\r\\n";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.pleiadesFlickrGroupOnly);\n  stack2 = helpers.unless;\n  tmp1 = self.program(5, program5, data);\n  tmp1.hash = {};\n  tmp1.fn = tmp1;\n  tmp1.inverse = self.noop;\n  stack1 = stack2.call(depth0, stack1, tmp1);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += "\\r\\n<p>The flickr photos shown here are those which have been given a Pleiades machine tag specifying this place. \\r\\n<a href=\\"http://www.flickr.com/groups/pleiades-places/discuss/72157628435317307/\\">See here for more information.</a></p>\\r\\n";\n  return buffer;});\n})();'}),define("lib/text!template/pleiades.tmpl",[],function(){return'(function() {\n  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};\ntemplates[\'pleiades\'] = template(function (Handlebars,depth0,helpers,partials,data) {\n  helpers = helpers || Handlebars.helpers;\n  var buffer = "", stack1, stack2, foundHelper, tmp1, self=this, functionType="function", helperMissing=helpers.helperMissing, undef=void 0, escapeExpression=this.escapeExpression;\n\nfunction program1(depth0,data) {\n  \n  var buffer = "", stack1;\n  buffer += "\\r\\n    <p>Some alternative names: ";\n  foundHelper = helpers.altNames;\n  stack1 = foundHelper || depth0.altNames;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "altNames", { hash: {} }); }\n  buffer += escapeExpression(stack1) + " (the results below are for all alternative names)</p>  \\r\\n    ";\n  return buffer;}\n\nfunction program3(depth0,data) {\n  \n  var buffer = "", stack1;\n  buffer += " \\r\\n    <div id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-map\\">    \\r\\n        <div id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-map_canvas\\" style=\\"width:425px; height:200px\\"></div>\\r\\n    </div>   \\r\\n    ";\n  return buffer;}\n\n  buffer += " <h1 id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-title\\" class=\\"pelagios-title\\">";\n  foundHelper = helpers.title;\n  stack1 = foundHelper || depth0.title;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "title", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "</h1>    \\r\\n<div class=\\"section-content\\" id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-pleiades\\">\\r\\n    <div id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-description\\"><p>";\n  foundHelper = helpers.description;\n  stack1 = foundHelper || depth0.description;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "description", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "</p>\\r\\n    ";\n  foundHelper = helpers.altNames;\n  stack1 = foundHelper || depth0.altNames;\n  stack2 = helpers[\'if\'];\n  tmp1 = self.program(1, program1, data);\n  tmp1.hash = {};\n  tmp1.fn = tmp1;\n  tmp1.inverse = self.noop;\n  stack1 = stack2.call(depth0, stack1, tmp1);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += "\\r\\n    ";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.displayMap);\n  stack2 = helpers[\'if\'];\n  tmp1 = self.program(3, program3, data);\n  tmp1.hash = {};\n  tmp1.fn = tmp1;\n  tmp1.inverse = self.noop;\n  stack1 = stack2.call(depth0, stack1, tmp1);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += "\\r\\n    <p><img src=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.baseURL);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.baseURL", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "images/icons/pleiades.png\\"  class=\\"pleiades-icon\\" />\\r\\n    <a href=\\"http://pleiades.stoa.org/places/";\n  foundHelper = helpers.pleiadesID;\n  stack1 = foundHelper || depth0.pleiadesID;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "pleiadesID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" target=\\"_blank\\">Entry in the Pleiades Gazetteer</a></p>    \\r\\n</div>";\n  return buffer;});\n})();'}),define("lib/text!template/pelagios_partner.tmpl",[],function(){return'(function() {\n  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};\ntemplates[\'pelagios_partner\'] = template(function (Handlebars,depth0,helpers,partials,data) {\n  helpers = helpers || Handlebars.helpers;\n  var buffer = "", stack1, stack2, foundHelper, tmp1, self=this, functionType="function", helperMissing=helpers.helperMissing, undef=void 0, escapeExpression=this.escapeExpression;\n\nfunction program1(depth0,data) {\n  \n  var buffer = "", stack1, stack2;\n  buffer += "\\r\\n\\r\\n<li id=\\"";\n  stack1 = depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-subdataset-";\n  stack1 = depth0.id;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.id", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\">\\r\\n<span id=\\"";\n  stack1 = depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-subdataset_title-";\n  stack1 = depth0.id;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.id", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\">\\r\\n    ";\n  stack1 = depth0.title;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.title", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\r\\n    <span id =\\"";\n  stack1 = depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-subdataset_hits-";\n  stack1 = depth0.id;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.id", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" class=\\"link\\">\\r\\n    ";\n  stack1 = depth0.references;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.references", { hash: {} }); }\n  buffer += escapeExpression(stack1) + " hit";\n  stack1 = depth0.multipleReferences;\n  stack2 = helpers[\'if\'];\n  tmp1 = self.program(2, program2, data);\n  tmp1.hash = {};\n  tmp1.fn = tmp1;\n  tmp1.inverse = self.noop;\n  stack1 = stack2.call(depth0, stack1, tmp1);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += "\\r\\n    </span>\\r\\n    <img id=\\"";\n  stack1 = depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-toggle-subdataset-";\n  stack1 = depth0.id;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.id", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" \\r\\n         src = \\"";\n  stack1 = depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.imageDir);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.widgetContext.imageDir", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "icons/right-arrow.png\\"  /> \\r\\n</span>\\r\\n    <div id=\\"";\n  stack1 = depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-subdataset_content-";\n  stack1 = depth0.id;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.id", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\">\\r\\n\\r\\n        <div id=\\"";\n  stack1 = depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-annotations-";\n  stack1 = depth0.id;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.id", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" class=\\"annotations\\">\\r\\n        </div>\\r\\n        <div id=\\"";\n  stack1 = depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-subdataset_pagination-";\n  stack1 = depth0.id;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.id", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" class=\\"subdataset_pagination\\">\\r\\n        </div>\\r\\n    </div>\\r\\n</li>\\r\\n\\r\\n";\n  return buffer;}\nfunction program2(depth0,data) {\n  \n  \n  return "s";}\n\n  buffer += "<ul class=\\"subdatasets\\" id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-subdatasets-";\n  foundHelper = helpers.rootDatasetID;\n  stack1 = foundHelper || depth0.rootDatasetID;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "rootDatasetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\">\\r\\n";\n  foundHelper = helpers.subdataset;\n  stack1 = foundHelper || depth0.subdataset;\n  stack2 = helpers.each;\n  tmp1 = self.program(1, program1, data);\n  tmp1.hash = {};\n  tmp1.fn = tmp1;\n  tmp1.inverse = self.noop;\n  stack1 = stack2.call(depth0, stack1, tmp1);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += "  \\r\\n</ul>         ";\n  return buffer;});\n})();'}),define("lib/text!template/error.tmpl",[],function(){return'(function() {\n  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};\ntemplates[\'error\'] = template(function (Handlebars,depth0,helpers,partials,data) {\n  helpers = helpers || Handlebars.helpers;\n  var buffer = "", stack1, foundHelper, self=this, functionType="function", helperMissing=helpers.helperMissing, undef=void 0, escapeExpression=this.escapeExpression;\n\n\n  buffer += "<h1 id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-title\\" class=\\"pelagios-title\\">";\n  foundHelper = helpers.title;\n  stack1 = foundHelper || depth0.title;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "title", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "</h1> \\r\\n<p>";\n  foundHelper = helpers.msg;\n  stack1 = foundHelper || depth0.msg;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "msg", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "</p>  \\r\\n";\n  return buffer;});\n})();'}),define("lib/text!template/search.tmpl",[],function(){return'(function() {\n  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};\ntemplates[\'search\'] = template(function (Handlebars,depth0,helpers,partials,data) {\n  helpers = helpers || Handlebars.helpers;\n  var buffer = "", stack1, foundHelper, self=this, functionType="function", helperMissing=helpers.helperMissing, undef=void 0, escapeExpression=this.escapeExpression;\n\n\n  buffer += "<h1 id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-title\\" class=\\"pelagios-title\\">Search for places</h1>    \\r\\n    <form id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-search-form\\" class=\\"search-form\\">\\r\\n        <input type=\\"text\\" size=\\"40\\"/>\\r\\n        <input id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-search-string\\" type=\\"submit\\" value=\\"Search\\"/>\\r\\n    </form>\\r\\n    <div id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-search-results\\">\\r\\n    </div> \\r\\n    <div id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-place\\">\\r\\n    </div>\\r\\n \\r\\n  \\r\\n \\r\\n";\n  return buffer;});\n})();'}),define("lib/text!template/annotations.tmpl",[],function(){return'(function() {\n  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};\ntemplates[\'annotations\'] = template(function (Handlebars,depth0,helpers,partials,data) {\n  helpers = helpers || Handlebars.helpers;\n  var buffer = "", stack1, stack2, foundHelper, tmp1, self=this, functionType="function", helperMissing=helpers.helperMissing, undef=void 0, escapeExpression=this.escapeExpression;\n\nfunction program1(depth0,data) {\n  \n  var buffer = "", stack1;\n  buffer += "\\r\\n<li><a href=\\"";\n  stack1 = depth0.uri;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.uri", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" target=\\"_blank\\">";\n  stack1 = depth0.label;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.label", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "</a></li>\\r\\n";\n  return buffer;}\n\n  buffer += "<ul class=\\"annotations\\" id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-annotations-";\n  foundHelper = helpers.subdatasetID;\n  stack1 = foundHelper || depth0.subdatasetID;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "subdatasetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\">\\r\\n";\n  foundHelper = helpers.annotation;\n  stack1 = foundHelper || depth0.annotation;\n  stack2 = helpers.each;\n  tmp1 = self.program(1, program1, data);\n  tmp1.hash = {};\n  tmp1.fn = tmp1;\n  tmp1.inverse = self.noop;\n  stack1 = stack2.call(depth0, stack1, tmp1);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += "\\r\\n</ul>";\n  return buffer;});\n})();'}),define("lib/text!template/search_results.tmpl",[],function(){return'(function() {\n  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};\ntemplates[\'search_results\'] = template(function (Handlebars,depth0,helpers,partials,data) {\n  helpers = helpers || Handlebars.helpers;\n  var buffer = "", stack1, stack2, foundHelper, tmp1, self=this, functionType="function", helperMissing=helpers.helperMissing, undef=void 0, escapeExpression=this.escapeExpression;\n\nfunction program1(depth0,data) {\n  \n  var buffer = "", stack1;\n  buffer += " \\r\\n<div id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-search-results-map\\" class=\\"search-map\\">\\r\\n    <p>Geographic Results for: <strong>";\n  foundHelper = helpers.searchString;\n  stack1 = foundHelper || depth0.searchString;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "searchString", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "</strong></p>\\r\\n    <div id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-search-map_canvas\\" style=\\"width:425px; height:200px\\"></div>\\r\\n</div>  \\r\\n";\n  return buffer;}\n\nfunction program3(depth0,data) {\n  \n  var buffer = "", stack1;\n  buffer += "\\r\\n<li id=\\"";\n  stack1 = depth0.widgetID;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "-place-";\n  stack1 = depth0.pleiadesID;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.pleiadesID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" class=\\"link\\">";\n  stack1 = depth0.label;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "this.label", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "</li>\\r\\n";\n  return buffer;}\n\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.displayMap);\n  stack2 = helpers[\'if\'];\n  tmp1 = self.program(1, program1, data);\n  tmp1.hash = {};\n  tmp1.fn = tmp1;\n  tmp1.inverse = self.noop;\n  stack1 = stack2.call(depth0, stack1, tmp1);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += "\\r\\n<div class=\\"list-results-section\\">\\r\\n<p>List Results for: <strong>";\n  foundHelper = helpers.searchString;\n  stack1 = foundHelper || depth0.searchString;\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "searchString", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "</strong>\\r\\n<div class=\\"list-results\\">\\r\\n<ul>\\r\\n";\n  foundHelper = helpers.place;\n  stack1 = foundHelper || depth0.place;\n  stack2 = helpers.each;\n  tmp1 = self.program(3, program3, data);\n  tmp1.hash = {};\n  tmp1.fn = tmp1;\n  tmp1.inverse = self.noop;\n  stack1 = stack2.call(depth0, stack1, tmp1);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += "\\r\\n</ul>\\r\\n</div>\\r\\n</div>";\n  return buffer;});\n})();'}),define("lib/text!template/new_tab.tmpl",[],function(){return'(function() {\n  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};\ntemplates[\'new_tab\'] = template(function (Handlebars,depth0,helpers,partials,data) {\n  helpers = helpers || Handlebars.helpers;\n  var buffer = "", stack1, foundHelper, self=this, functionType="function", helperMissing=helpers.helperMissing, undef=void 0, escapeExpression=this.escapeExpression;\n\n\n  buffer += "<!DOCTYPE html>\\r\\n<html>\\r\\n  <head>\\r\\n\\r\\n  </head>\\r\\n  <body >\\r\\n\\r\\n        <div id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.widgetID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.widgetID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" data-pleiades_id=\\"";\n  foundHelper = helpers.widgetContext;\n  stack1 = foundHelper || depth0.widgetContext;\n  stack1 = (stack1 === null || stack1 === undefined || stack1 === false ? stack1 : stack1.pleiadesID);\n  if(typeof stack1 === functionType) { stack1 = stack1.call(depth0, { hash: {} }); }\n  else if(stack1=== undef) { stack1 = helperMissing.call(depth0, "widgetContext.pleiadesID", { hash: {} }); }\n  buffer += escapeExpression(stack1) + "\\" \\r\\n        data-icon=\\"false\\"\\r\\n        class=\\"pelagios pelagios-place\\"></div>\\r\\n</body>\\r\\n</html>";\n  return buffer;});\n})();'}),define("lib/text!template/about.tmpl",[],function(){return'(function() {\n  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};\ntemplates[\'about\'] = template(function (Handlebars,depth0,helpers,partials,data) {\n  helpers = helpers || Handlebars.helpers;\n  var foundHelper, self=this;\n\n\n  return "<p>This widget displays data from the Pelagios project partners about the location specified.</p>\\r\\n<p>View the <a href=\\"http://pelagios-project.blogspot.co.uk/\\" target=\\"_blank\\">Pelagios website</a>\\r\\n for more information.</a>\\r\\n            ";});\n})();'}),define("lib/text!app/dataset.json",[],function(){return'[{\r\n  "id": "b47df24737cd647789c7d61ede9fed09",\r\n  "title": "Arachne",\r\n  "iconFileName": "arachne.png",\r\n  "strapline": "A web research tool of the German Archaeological Institute for searching mass archaeological records"\r\n},\r\n{\r\n  "id": "6a39d0bc3c0fd4ef7d2a837b42cf46a1",\r\n  "title": "Google Ancient Places",\r\n  "iconFileName": "gap_logo.png",\r\n  "strapline":  "A Geographic Annotation Platform for reading texts spatially"\r\n}\r\n,\r\n{\r\n  "id": "2db51c1dd976f01bf993a02f959e18f8",\r\n  "title": "nomisma",\r\n  "iconFileName": "Greek.jpeg",\r\n  "strapline":  "Representing ancient coins online"\r\n}\r\n,\r\n{\r\n  "id": "XXX",\r\n  "title": "SPQR",\r\n  "iconFileName": "SPQR.png",\r\n  "strapline":  "From Roman inscriptions to resource descriptions"\r\n}\r\n,\r\n{\r\n  "id": "",\r\n  "title": "Regnum Francorum Online",\r\n  "iconFileName": "Regnum.png",\r\n  "strapline":  "Interactive Maps and Sources of Late Antique and Early Medieval Europe"\r\n}\r\n,\r\n{\r\n  "id": "21e48d8ca46f666467b81a551fbb1cb",\r\n  "title": "Perseus",\r\n  "iconFileName": "Perseus.png",\r\n  "strapline":  "Annotated occurrences of place entities in texts from the Perseus Digital Library"\r\n}\r\n,\r\n{\r\n  "id": "XXX",\r\n  "title": "CLAROS",\r\n  "iconFileName": "CLAROS.png",\r\n  "strapline":  "Aggregated search of art and archaeology data from the classical world and the far east across four millennia"\r\n}\r\n,\r\n{\r\n  "id": "739128af1e9613de03706a57cef46976",\r\n  "title": "Open Context",\r\n  "iconFileName": "open-context.png",\r\n  "strapline":  "Publications of research data in archaeology and related fields"\r\n}\r\n,\r\n{\r\n  "id": "467b9097b55b6e0831fe6760df93e7f2",\r\n  "title": "FASTI Online",\r\n  "iconFileName": "FASTI.png",\r\n  "strapline":  "A database of archaeological excavations since the year 2000"\r\n}\r\n,\r\n{\r\n  "id": "a306666ae581e8d611d56a1dfdaea256",\r\n  "title": "Ure Museum",\r\n  "iconFileName": "URE.png",\r\n  "strapline":  "University Museum of ancient Greek, Egyptian & a little Roman stuff"\r\n}\r\n\r\n\r\n]\r\n\r\n\r\n'}),define("lib/jquery_pagination",["jquery"],function($){(function($){$.PaginationCalculator=function(maxentries,opts){this.maxentries=maxentries,this.opts=opts},$.extend($.PaginationCalculator.prototype,{numPages:function(){return Math.ceil(this.maxentries/this.opts.items_per_page)},getInterval:function(current_page){var ne_half=Math.floor(this.opts.num_display_entries/2),np=this.numPages(),upper_limit=np-this.opts.num_display_entries,start=current_page>ne_half?Math.max(Math.min(current_page-ne_half,upper_limit),0):0,end=current_page>ne_half?Math.min(current_page+ne_half+this.opts.num_display_entries%2,np):Math.min(this.opts.num_display_entries,np);return{start:start,end:end}}}),$.PaginationRenderers={},$.PaginationRenderers.defaultRenderer=function(maxentries,opts){this.maxentries=maxentries,this.opts=opts,this.pc=new $.PaginationCalculator(maxentries,opts)},$.extend($.PaginationRenderers.defaultRenderer.prototype,{createLink:function(page_id,current_page,appendopts){var lnk,np=this.pc.numPages();return page_id=page_id<0?0:page_id<np?page_id:np-1,appendopts=$.extend({text:page_id+1,classes:""},appendopts||{}),page_id==current_page?lnk=$("<span class='current'>"+appendopts.text+"</span>"):lnk=$("<a>"+appendopts.text+"</a>").attr("href",this.opts.link_to.replace(/__id__/,page_id)),appendopts.classes&&lnk.addClass(appendopts.classes),lnk.data("page_id",page_id),lnk},appendRange:function(container,current_page,start,end,opts){var i;for(i=start;i<end;i++)this.createLink(i,current_page,opts).appendTo(container)},getLinks:function(current_page,eventHandler){var begin,end,interval=this.pc.getInterval(current_page),np=this.pc.numPages(),fragment=$("<div class='pagination'></div>");return this.opts.prev_text&&(current_page>0||this.opts.prev_show_always)&&fragment.append(this.createLink(current_page-1,current_page,{text:this.opts.prev_text,classes:"prev"})),interval.start>0&&this.opts.num_edge_entries>0&&(end=Math.min(this.opts.num_edge_entries,interval.start),this.appendRange(fragment,current_page,0,end,{classes:"sp"}),this.opts.num_edge_entries<interval.start&&this.opts.ellipse_text&&$("<span>"+this.opts.ellipse_text+"</span>").appendTo(fragment)),this.appendRange(fragment,current_page,interval.start,interval.end),interval.end<np&&this.opts.num_edge_entries>0&&(np-this.opts.num_edge_entries>interval.end&&this.opts.ellipse_text&&$("<span>"+this.opts.ellipse_text+"</span>").appendTo(fragment),begin=Math.max(np-this.opts.num_edge_entries,interval.end),this.appendRange(fragment,current_page,begin,np,{classes:"ep"})),this.opts.next_text&&(current_page<np-1||this.opts.next_show_always)&&fragment.append(this.createLink(current_page+1,current_page,{text:this.opts.next_text,classes:"next"})),$("a",fragment).click(eventHandler),fragment}}),$.fn.pagination=function(maxentries,opts){function paginationClickHandler(evt){evt.preventDefault();var links,new_current_page=$(evt.target).data("page_id"),continuePropagation=selectPage(new_current_page);return continuePropagation||evt.stopPropagation(),continuePropagation}function selectPage(new_current_page){containers.data("current_page",new_current_page),links=renderer.getLinks(new_current_page,paginationClickHandler),containers.empty(),links.appendTo(containers);var continuePropagation=opts.callback(new_current_page,containers);return continuePropagation}opts=$.extend({items_per_page:10,num_display_entries:11,current_page:0,num_edge_entries:0,link_to:"#",prev_text:"Prev",next_text:"Next",ellipse_text:"...",prev_show_always:!0,next_show_always:!0,renderer:"defaultRenderer",show_if_single_page:!1,load_first_page:!0,callback:function(){return!1}},opts||{});var containers=this,renderer,links,current_page;current_page=parseInt(opts.current_page),containers.data("current_page",current_page),maxentries=!maxentries||maxentries<0?1:maxentries,opts.items_per_page=!opts.items_per_page||opts.items_per_page<0?1:opts.items_per_page;if(!$.PaginationRenderers[opts.renderer])throw new ReferenceError("Pagination renderer '"+opts.renderer+"' was not found in jQuery.PaginationRenderers object.");renderer=new $.PaginationRenderers[opts.renderer](maxentries,opts);var pc=new $.PaginationCalculator(maxentries,opts),np=pc.numPages();containers.bind("setPage",{numPages:np},function(evt,page_id){if(page_id>=0&&page_id<evt.data.numPages)return selectPage(page_id),!1}),containers.bind("prevPage",function(evt){var current_page=$(this).data("current_page");return current_page>0&&selectPage(current_page-1),!1}),containers.bind("nextPage",{numPages:np},function(evt){var current_page=$(this).data("current_page");return current_page<evt.data.numPages-1&&selectPage(current_page+1),!1}),links=renderer.getLinks(current_page,paginationClickHandler),containers.empty(),(np>1||opts.show_if_single_page)&&links.appendTo(containers),opts.load_first_page&&opts.callback(current_page,containers)}})(jQuery)}),define("app/pelagios",["jquery","app/util","app/search_map","app/place_map","lib/text!template/widget_container.tmpl","lib/text!template/place.tmpl","lib/text!template/section.tmpl","lib/text!template/flickr.tmpl","lib/text!template/pleiades.tmpl","lib/text!template/pelagios_partner.tmpl","lib/text!template/error.tmpl","lib/text!template/search.tmpl","lib/text!template/annotations.tmpl","lib/text!template/search_results.tmpl","lib/text!template/new_tab.tmpl","lib/text!template/about.tmpl","lib/text!app/dataset.json","jqueryui","lib/jquery_pagination"],function($,util,search_map,place_map,widget_container_tmpl,place_tmpl,section_tmpl,flickr_tmpl,pleiades_tmpl,pelagios_partner_tmpl,error_tmpl,search_tmpl,annotations_tmpl,search_results_tmpl,new_tab_tmpl,about_tmpl,datasetJSON){function Widget(widgetContext){function addAboutSection(){}function widgetPopUp(){if(widgetContext.newTab){var w=window.open(),html=Handlebars.templates.new_tab({widgetContext:widgetContext});$(w.document.body).html(html);var script1=document.createElement("script");script1.type="text/javascript",script1.src=widgetContext.baseURL+"lib/require.js",w.document.head.appendChild(script1);var script2=document.createElement("script");script2.type="text/javascript",script2.src=widgetContext.baseURL+"place.js",w.document.head.appendChild(script2)}else{$(".pelagios .container").hide(),$("#"+widgetContext.widgetID+"-container").show();var icon_offset=$("#"+widgetContext.widgetID+"-icon").offset(),container_offset={top:$(window).scrollTop(),left:200};$("#"+widgetContext.widgetID+"-container").offset(container_offset),widgetContext.displayMap&&placeMap.hasOwnProperty("refresh")&&placeMap.refresh()}}function displayPlace(pleiadesID){debug("DISPLAYING PLACE: pleiadesID: "+pleiadesID),placeMap={},clearPlace(),showPleiadesData(pleiadesID),widgetContext.type=="place"&&showAboutInformation(),showPelagiosData(pleiadesID),showFlickrData(pleiadesID)}function showAboutInformation(){addSection("about","About Pelagios and this widget",widgetContext.imageDir+"partner_icons/pelagios.png","");var html=Handlebars.templates.about();$("#"+widgetContext.widgetID+"-content-about").append(html)}function clearPlace(){$("#"+widgetContext.widgetID+"-pleiades").empty(),$("#"+widgetContext.widgetID+"-sections").empty()}function showFlickrData(pleiadesID){function displayFlickrData(json){if(json.hasOwnProperty("photos")&&json.photos.hasOwnProperty("photo")&&json.photos.photo.length>0){addSection("flickr","flickr",widgetContext.imageDir+"icons/flickr-logo.png","Photo sharing website");var data={photo:json.photos.photo.slice(0,config.MAX_PHOTOS_FLICKR-1),pleiadesID:pleiadesID},html=Handlebars.templates.flickr(data);$("#"+widgetContext.widgetID+"-content-flickr").append(html)}}var groupURIComponent="";widgetContext.pleiadesFlickrGroupOnly&&(groupURIComponent="&group_id=1876758@N22");var url=config.URL_FLICKR_SEARCH+"&machine_tags=pleiades:depicts="+pleiadesID+groupURIComponent+"&tag_mode=all&api_key="+config.API_KEY_FLICKR+"&jsoncallback=?";util.getAPIData(url,displayFlickrData,!1,config.TIMEOUT_FLICKR,!1)}function showPleiadesData(pleiadesID){function displayPleiadesError(jqXHR,textStatus,errorThrown){$("#"+widgetContext.widgetID+"-content").empty();if(jqXHR.status=="404")var data={title:config.MSG_TITLE_PLACE_NOT_FOUND,msg:config.MSG_PLACE_NOT_FOUND};else var data={title:config.MSG_TITLE_PLEIADES_TIMEOUT,msg:config.MSG_PLEIADES_TIMEOUT};var html=Handlebars.templates.error(data);$("#"+widgetContext.widgetID+"-content").append(html)}function displayPleiadesData(data){var altNames=!1;data.names.length>1&&(altNames=data.names.join(", "));var placeData={title:data.names[0]?data.names[0]:"Untitled",description:data.description,altNames:altNames,pleiadesID:data.id,widgetContext:widgetContext},html=Handlebars.templates.pleiades(placeData);$("#"+widgetContext.widgetID+"-pleiades").append(html),widgetContext.displayMap&&(placeMap=new place_map.PlaceMap(widgetContext.widgetID+"-map_canvas"),placeMap.setMarker(data.reprPoint,data.names[0])),showPlace()}var pleiadesURI=config.URL_PLEIADES+pleiadesID,pleiadesAPIURL=config.URL_PLEIADES+pleiadesID+"/json";util.getAPIData(pleiadesAPIURL,displayPleiadesData,displayPleiadesError,config.TIMEOUT_PLEIADES,!0)}function showPelagiosData(pleiadesID){function displayPelagiosData(json){$.each(json,function(key,rootDataset){rootDataset.hasOwnProperty("root_dataset")&&(rootDataset=rootDataset.root_dataset);var rootDatasetInfo;rootDatasetID=rootDataset.uri.replace(/http:\/\/pelagios.dme.ait.ac.at\/api\/datasets\//g,""),rootDatasetInfo=getDatasetInfo(rootDatasetID);if(typeof rootDatasetInfo!="undefined"){addSection(rootDatasetID,rootDatasetInfo.title,widgetContext.iconDir+rootDatasetInfo.iconFileName,rootDatasetInfo.strapline);var subdataset=new Array;if(typeof rootDataset.subsets!="undefined")for(var i=0;i<rootDataset.subsets.length;i++)subdataset[i]={},subdataset[i].widgetContext=widgetContext,subdataset[i].title=rootDataset.subsets[i].title,subdataset[i].id=rootDataset.subsets[i].uri.replace(/http:\/\/pelagios.dme.ait.ac.at\/api\/datasets\//g,""),subdataset[i].references=rootDataset.subsets[i].annotations_referencing_place,subdataset[i].multipleReferences=subdataset[i].references>1?!0:!1,subdataset[i].anyReferences=subdataset[i].references>0?!0:!1;else subdataset[0]={},subdataset[0].widgetContext=widgetContext,subdataset[0].title=rootDataset.title,subdataset[0].id=rootDatasetID,subdataset[0].references=rootDataset.annotations_referencing_place,subdataset[0].multipleReferences=subdataset[0].references>1?!0:!1;var data={subdataset:subdataset,rootDatasetID:rootDatasetID,widgetContext:widgetContext},html=Handlebars.templates.pelagios_partner(data);$("#"+widgetContext.widgetID+"-content-"+rootDatasetID).append(html),$("#"+widgetContext.widgetID+"-subdatasets-"+rootDatasetID).css("list-style-image","url("+widgetContext.imageDir+"icons/bullet.png)");for(var i=0;i<subdataset.length;i++)subdatasetSetup(subdataset[i])}else debug("ERROR: Could not find info for root dataset "+rootDataset.title+" "+pelagiosURL)})}function subdatasetSetup(subdataset){$("#"+widgetContext.widgetID+"-subdataset_title-"+subdataset.id).click({id:subdataset.id},clickDisplaySubdataset),$("#"+widgetContext.widgetID+"-subdataset_content-"+subdataset.id).hide();var callback=function(newPageIndex){handlePaginationClick(newPageIndex,subdataset.id)};$("#"+widgetContext.widgetID+"-subdataset_pagination-"+subdataset.id).pagination(subdataset.references,{items_per_page:config.NUM_ANNOTATIONS_TO_DISPLAY,callback:callback}),handlePaginationClick(0,subdataset.id)}function handlePaginationClick(newPageIndex,subdatasetID){var url=config.URL_PELAGIOS_API_V2+"datasets/"+subdatasetID+"/annotations.json?forPlace="+encodeURIComponent(config.URL_PLEIADES+pleiadesID)+"&limit="+config.NUM_ANNOTATIONS_TO_DISPLAY+"&offset="+newPageIndex*config.NUM_ANNOTATIONS_TO_DISPLAY+"&callback=?",success=function(json){typeof json.annotations!="undefined"&&json.annotations.length>0&&displayAnnotations(json.annotations,subdatasetID)};return util.getAPIData(url,success),!1}function displayAnnotations(annotations,subsetID){var annotation=new Array;$.each(annotations,function(key,val){annotation[key]={},val.hasOwnProperty("target_title")?annotation[key].label=val.target_title:annotation[key].label=val.title?val.title:"Item "+(key+1),annotation[key].uri=val.hasTarget});var data={subdatasetID:subsetID,annotation:annotation,widgetContext:widgetContext},html=Handlebars.templates.annotations(data);$("#"+widgetContext.widgetID+"-annotations-"+subsetID).empty(),$("#"+widgetContext.widgetID+"-annotations-"+subsetID).append(html),$("#"+widgetContext.widgetID+"-subdataset-"+subsetID).focus()}function clickDisplaySubdataset(data){var subdatasetID=data.data.id;toggleSelectedLink(widgetContext.widgetID+"-subdataset_hits-"+subdatasetID),$("#"+widgetContext.widgetID+"-subdataset_content-"+subdatasetID).toggle(),toggleIcon(widgetContext.widgetID+"-toggle-subdataset-"+subdatasetID)}function hideSubdataset(id){$("#"+widgetID+"-subdataset_content-"+id).hide()}var pelagiosURL=config.URL_PELAGIOS_API_V2+"places/"+encodeURIComponent(config.URL_PLEIADES+pleiadesID)+"/datasets.json?callback=?";util.getAPIData(pelagiosURL,displayPelagiosData,!1,config.TIMEOUT_PELAGIOS,!1)}function displaySearchResults(){var pelagiosURL=config.URL_PELAGIOS_API_V2+"search.json?query="+searchString+"&callback=?";debug("RETRIEVING SEARCH DATA: searchString: "+searchString+" URL:"+pelagiosURL),util.getAPIData(pelagiosURL,displaySearchResultsData,!1,config.TIMEOUT_PELAGIOS,!1)}function displaySearchResultsData(json){$("#"+widgetContext.widgetID+"-search-map").empty(),$("#"+widgetContext.widgetID+"-search-results").empty(),$("#"+widgetContext.widgetID+"-pleiades").empty(),$("#"+widgetContext.widgetID+"-sections").empty();if(json.length>0){var places=new Array;$.each(json,function(key,val){place={},place.label=val.label,place.pleiadesID=val.uri.replace(/.*places.*F/g,""),place.geojson=val,place.content="<h2>"+place.label+"</h2>",place.content+='<p id="'+widgetContext.widgetID+"-info-"+place.pleiadesID+'">View info</p>',place.widgetID=widgetContext.widgetID,places[key]=place});var data={place:places,widgetContext:widgetContext,searchString:searchString},html=Handlebars.templates.search_results(data);$("#"+widgetContext.widgetID+"-search-results").append(html),widgetContext.displayMap&&(searchMap=new search_map.SearchMap(widgetContext.widgetID+"-search-map_canvas")),$.each(places,function(key,place){widgetContext.displayMap&&searchMap.addMarker(place.geojson,place.label,place.content,function(){onClickHandler(place.pleiadesID)}),$("#"+widgetContext.widgetID+"-place-"+place.pleiadesID).click(function(){onClickHandler(place.pleiadesID)})});function onClickHandler(pleiadesID){$(".pelagios-search-result-list li").css("text-decoration","none"),$(".pelagios-search-result-list li").css("font-weight","normal"),$("#"+widgetContext.widgetID+"-place-"+pleiadesID).css("text-decoration","underline"),$("#"+widgetContext.widgetID+"-place-"+pleiadesID).css("font-weight","bold"),displayPlace(pleiadesID)}showSearchResults()}else $("#"+widgetContext.widgetID+"-search-results").append("<h3 class='no-search-results'>No matches found for '"+searchString+"'</h3>"),$("#"+widgetContext.widgetID+"-search-results").show()}function hideSearchResults(){$("#"+widgetContext.widgetID+"-search-results-map").hide(),$("#"+widgetContext.widgetID+"-search-results").hide()}function showSearchResults(){widgetContext.displayMap&&($("#"+widgetContext.widgetID+"-search-results-map").show(),searchMap.refresh()),$("#"+widgetContext.widgetID+"-search-results").show()}function hidePlace(){$("#"+widgetContext.widgetID+"-map").hide(),$("#"+widgetContext.widgetID+"-place").hide()}function showPlace(){$("#"+widgetContext.widgetID+"-place").show(),widgetContext.displayMap&&($("#"+widgetContext.widgetID+"-map").show(),placeMap.refresh())}function addSection(name,title,iconURL,strapline){var data={name:name,title:title,iconURL:iconURL,strapline:strapline,widgetContext:widgetContext},html=Handlebars.templates.section(data);$("#"+widgetContext.widgetID+"-sections").append(html),$("#"+widgetContext.widgetID+"-content-"+name).hide(),$("#"+widgetContext.widgetID+"-header-"+name).click(function(){$("#"+widgetContext.widgetID+"-content-"+name).toggle(),toggleIcon(widgetContext.widgetID+"-toggle-"+name)})}function toggleIcon(id){var current_icon=$("#"+id).attr("src"),new_icon=current_icon==widgetContext.imageDir+"icons/down-arrow.png"?widgetContext.imageDir+"icons/right-arrow.png":widgetContext.imageDir+"icons/down-arrow.png";$("#"+id).attr("src",new_icon)}function toggleSelectedLink(id){var element=$("#"+id),current_style=element.css("text-decoration"),new_style=current_style=="underline"?"none":"underline";element.css("text-decoration",new_style)}function getDatasetInfo(id){var datasetInfo;return $.each(dataset,function(key,info){info.id==rootDatasetID&&(datasetInfo=info)}),datasetInfo}function debug(msg){widgetContext.debug&&console.log(msg)}var placeMap={},searchMap={},searchString="";eval(widget_container_tmpl),eval(place_tmpl),eval(section_tmpl),eval(flickr_tmpl),eval(pleiades_tmpl),eval(pelagios_partner_tmpl),eval(error_tmpl),eval(search_tmpl),eval(annotations_tmpl),eval(search_results_tmpl),eval(new_tab_tmpl),eval(about_tmpl);var dataset=$.parseJSON(datasetJSON);typeof $("#"+widgetContext.widgetID)==undefined&&debug("ERROR: $(#"+widgetContext.widgetID+") is undefined"),$("head").append('<link rel="stylesheet" type="text/css" href="'+widgetContext.cssDir+'pelagios.css" media="screen" />');var html=Handlebars.templates.widget_container({widgetContext:widgetContext});$("#"+widgetContext.widgetID).append(html),$("#"+widgetContext.widgetID+"-container").draggable(),this.setTypePlace=function(){var html=Handlebars.templates.place({widgetContext:widgetContext});$("#"+widgetContext.widgetID+"-content").append(html),hidePlace(),widgetContext.icon==1&&($("#"+widgetContext.widgetID+"-container").hide(),$("#"+widgetContext.widgetID+"-icon").click(widgetPopUp),widgetContext.onMouseOver&&($("#"+widgetContext.widgetID+"-icon").mouseover(widgetPopUp),$(document).click(function(){$("#"+widgetContext.widgetID+"-container").hide()}),$("#"+widgetContext.widgetID).click(function(e){return e.stopPropagation(),!1})),$("#"+widgetContext.widgetID+"-close-widget").click(function(){$("#"+widgetContext.widgetID+"-container").hide()})),displayPlace(widgetContext.pleiadesID)},this.setTypeSearch=function(){var html=Handlebars.templates.search({widgetContext:widgetContext});$("#"+widgetContext.widgetID+"-content").append(html);var html=Handlebars.templates.place({widgetContext:widgetContext});$("#"+widgetContext.widgetID+"-content").append(html),hidePlace(),hideSearchResults(),$("#"+widgetContext.widgetID+"-search-form").submit(function(){return searchString=$("input:first").val(),displaySearchResults(),!1})}}var config={URL_PELAGIOS_API_V2:"http://pelagios.dme.ait.ac.at/api/",API_KEY_FLICKR:"ddf82df2aba035bfcf14c12a4eff3335",TIMEOUT_PLEIADES:6e3,TIMEOUT_PELAGIOS:6e4,TIMEOUT_FLICKR:6e3,URL_PLEIADES:"http://pleiades.stoa.org/places/",URL_FLICKR_SEARCH:"http://api.flickr.com/services/rest/?format=json&method=flickr.photos.search",MAX_PHOTOS_FLICKR:30,MSG_PLACE_NOT_FOUND:"The place specified for this widget does not exist in the Pleiades gazetteer.",MSG_TITLE_PLACE_NOT_FOUND:"Error: Unknown Place",MSG_PLEIADES_TIMEOUT:"We cannot display the place name and map at the moment because the Pleiades website is not responding. Apologies for the inconvenience and please try again later.",MSG_TITLE_PLEIADES_TIMEOUT:"Error: Pleiades not responding",NUM_ANNOTATIONS_TO_DISPLAY:20};return{Widget:Widget}});var Handlebars={};Handlebars.VERSION="1.0.beta.2",Handlebars.helpers={},Handlebars.partials={},Handlebars.registerHelper=function(name,fn,inverse){inverse&&(fn.not=inverse),this.helpers[name]=fn},Handlebars.registerPartial=function(name,str){this.partials[name]=str},Handlebars.registerHelper("helperMissing",function(arg){if(arguments.length===2)return undefined;throw new Error("Could not find property '"+arg+"'")}),Handlebars.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse||function(){},fn=options.fn,ret="",type=Object.prototype.toString.call(context);type==="[object Function]"&&(context=context());if(context===!0)return fn(this);if(context===!1||context==null)return inverse(this);if(type==="[object Array]"){if(context.length>0)for(var i=0,j=context.length;i<j;i++)ret+=fn(context[i]);else ret=inverse(this);return ret}return fn(context)}),Handlebars.registerHelper("each",function(context,options){var fn=options.fn,inverse=options.inverse,ret="";if(context&&context.length>0)for(var i=0,j=context.length;i<j;i++)ret+=fn(context[i]);else ret=inverse(this);return ret}),Handlebars.registerHelper("if",function(context,options){return!context||Handlebars.Utils.isEmpty(context)?options.inverse(this):options.fn(this)}),Handlebars.registerHelper("unless",function(context,options){var fn=options.fn,inverse=options.inverse;return options.fn=inverse,options.inverse=fn,Handlebars.helpers["if"].call(this,context,options)}),Handlebars.registerHelper("with",function(context,options){return options.fn(context)}),Handlebars.Exception=function(message){var tmp=Error.prototype.constructor.apply(this,arguments);for(var p in tmp)tmp.hasOwnProperty(p)&&(this[p]=tmp[p])},Handlebars.Exception.prototype=new Error,Handlebars.SafeString=function(string){this.string=string},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()},function(){var escape={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},badChars=/&(?!\w+;)|[<>"'`]/g,possible=/[&<>"'`]/,escapeChar=function(chr){return escape[chr]||"&amp;"};Handlebars.Utils={escapeExpression:function(string){return string instanceof Handlebars.SafeString?string.toString():string==null||string===!1?"":possible.test(string)?string.replace(badChars,escapeChar):string},isEmpty:function(value){return typeof value=="undefined"?!0:value===null?!0:value===!1?!0:Object.prototype.toString.call(value)==="[object Array]"&&value.length===0?!0:!1}}}(),Handlebars.VM={template:function(templateSpec){var container={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(i,fn,data){var programWrapper=this.programs[i];return data?Handlebars.VM.program(fn,data):programWrapper?programWrapper:(programWrapper=this.programs[i]=Handlebars.VM.program(fn),programWrapper)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(context,options){return options=options||{},templateSpec.call(container,Handlebars,context,options.helpers,options.partials,options.data)}},programWithDepth:function(fn,data,$depth){var args=Array.prototype.slice.call(arguments,2);return function(context,options){return options=options||{},fn.apply(this,[context,options.data||data].concat(args))}},program:function(fn,data){return function(context,options){return options=options||{},fn(context,options.data||data)}},noop:function(){return""},invokePartial:function(partial,name,context,helpers,partials){if(partial===undefined)throw new Handlebars.Exception("The partial "+name+" could not be found");if(partial instanceof Function)return partial(context,{helpers:helpers,partials:partials});if(!Handlebars.compile)throw new Handlebars.Exception("The partial "+name+" could not be compiled when running in vm mode");return partials[name]=Handlebars.compile(partial),partials[name](context,{helpers:helpers,partials:partials})}},Handlebars.template=Handlebars.VM.template,define("lib/handlebars",function(){});if(!PELAGIOS_PLACE_MAIN_JS_RUN){var PELAGIOS_PLACE_MAIN_JS_RUN=!0;(function(){var scripts=document.getElementsByTagName("script"),src=scripts[scripts.length-1].src,baseURL=src.replace(/place.js/g,"");require.config({paths:{jquery:"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min",jqueryui:"https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min"},priority:["jquery"],jQuery:"1.7.1",waitSeconds:5,baseUrl:baseURL,shim:{jqueryui:{deps:["jquery"]},"lib/jquery_pagination":{deps:["jquery"]}}}),require(["app/pelagios","app/util","lib/handlebars"],function(pelagios,util){$(document).ready(function($){var debug=!0;if(debug){var msg="FINDING PLACE WIDGETS ON PAGE: ";$(".pelagios-place").each(function(){msg+=" "+$(this).attr("id")}),console.log(msg)}$(".pelagios-place").each(function(){var widgetContext={baseURL:baseURL,widgetID:$(this).attr("id"),pleiadesID:$(this).attr("data-pleiades_id"),displayMap:$(this).attr("data-display_map")?$(this).attr("data-display_map")!=="false":!0,onMouseOver:$(this).attr("data-mouseover")?$(this).attr("data-mouseover")==="true":!1,debug:$(this).attr("data-debug")?$(this).attr("data-debug")==="true":!0,icon:$(this).attr("data-icon")?$(this).attr("data-icon")==="true":!0,newTab:$(this).attr("data-new_tab")?$(this).attr("data-new_tab")==="true":!1,templateDir:baseURL+"template/",imageDir:baseURL+"images/",iconDir:baseURL+"images/partner_icons/",scriptDir:baseURL+"scripts/",cssDir:baseURL+"css/",pleiadesFlickrGroupOnly:!1,type:"place"};util.includesGoogleMaps2()&&(widgetContext.displayMap=!1),widgetContext.debug&&console.log("CREATING WIDGET pleiadesID:"+widgetContext.pleiadesID+" widgetID:"+widgetContext.widgetID+" baseURL:"+widgetContext.baseURL),widget=new pelagios.Widget(widgetContext),widget.setTypePlace()})})})})()}define("place",function(){})